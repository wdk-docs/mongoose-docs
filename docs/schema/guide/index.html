
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Mongodb NodeJs 组件中文文档">
      
      
      
        <meta name="author" content="Nosy">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.2">
    
    
      
        <title>模式手册 - Mongoose文档</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.24c991ad.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Mongoose文档" class="md-header__button md-logo" aria-label="Mongoose文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mongoose文档
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              模式手册
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/wohugb/mongoose-docs" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    wohugb/mongoose-docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Mongoose文档" class="md-nav__button md-logo" aria-label="Mongoose文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Mongoose文档
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/wohugb/mongoose-docs" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    wohugb/mongoose-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        前言
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../QuickStart/" class="md-nav__link">
        快速开始
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          连接
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="连接" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          连接
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../connection/guide/" class="md-nav__link">
        连接手册
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../connection/api/" class="md-nav__link">
        连接API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          模式
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="模式" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          模式
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          模式手册
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        模式手册
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    定义你的模式
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    创建一个模式
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    实例方法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    静态方法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    查询助手
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    索引
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    虚拟字段
  </a>
  
    <nav class="md-nav" aria-label="虚拟字段">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    别名
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    选项
  </a>
  
    <nav class="md-nav" aria-label="选项">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoindex" class="md-nav__link">
    autoIndex
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buffercommands" class="md-nav__link">
    bufferCommands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#capped" class="md-nav__link">
    capped
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collection" class="md-nav__link">
    collection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id" class="md-nav__link">
    id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_id" class="md-nav__link">
    _id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minimize" class="md-nav__link">
    minimize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read" class="md-nav__link">
    read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shardkey" class="md-nav__link">
    shardKey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strict" class="md-nav__link">
    strict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tojson" class="md-nav__link">
    toJSON
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#toobject" class="md-nav__link">
    toObject
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#typekey" class="md-nav__link">
    typeKey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validatebeforesave" class="md-nav__link">
    validateBeforeSave
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#versionkey" class="md-nav__link">
    versionKey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collation" class="md-nav__link">
    collation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skipversioning" class="md-nav__link">
    skipVersioning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timestamps" class="md-nav__link">
    timestamps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usenestedstrict" class="md-nav__link">
    useNestedStrict
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    可插拔
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    接下来
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        模式API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../type/" class="md-nav__link">
        模式类型API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          模型
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="模型" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          模型
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/guide/" class="md-nav__link">
        模型手册
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/api/" class="md-nav__link">
        模型API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          文档
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="文档" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          文档
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../document/guide/" class="md-nav__link">
        文档手册
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../document/api/" class="md-nav__link">
        文档API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          查询
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="查询" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          查询
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../query/guide/" class="md-nav__link">
        查询手册
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../query/api/" class="md-nav__link">
        查询API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          其它手册
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="其它手册" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          其它手册
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/Validation/" class="md-nav__link">
        验证
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/Middleware/" class="md-nav__link">
        中间件
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/Populate/" class="md-nav__link">
        填充
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/Discriminators/" class="md-nav__link">
        鉴别器
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/Plugins/" class="md-nav__link">
        插件
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          其它API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="其它API" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          其它API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Aggregate/" class="md-nav__link">
        聚合
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/VirtualType/" class="md-nav__link">
        虚拟类型
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Error/" class="md-nav__link">
        错误
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../migrating_to_5/" class="md-nav__link">
        升级到5
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../VersionCompatibility/" class="md-nav__link">
        版本兼容性
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../FAQ/" class="md-nav__link">
        常问问题
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    定义你的模式
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    创建一个模式
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    实例方法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    静态方法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    查询助手
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    索引
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    虚拟字段
  </a>
  
    <nav class="md-nav" aria-label="虚拟字段">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    别名
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    选项
  </a>
  
    <nav class="md-nav" aria-label="选项">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoindex" class="md-nav__link">
    autoIndex
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buffercommands" class="md-nav__link">
    bufferCommands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#capped" class="md-nav__link">
    capped
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collection" class="md-nav__link">
    collection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id" class="md-nav__link">
    id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_id" class="md-nav__link">
    _id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minimize" class="md-nav__link">
    minimize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read" class="md-nav__link">
    read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shardkey" class="md-nav__link">
    shardKey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strict" class="md-nav__link">
    strict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tojson" class="md-nav__link">
    toJSON
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#toobject" class="md-nav__link">
    toObject
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#typekey" class="md-nav__link">
    typeKey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validatebeforesave" class="md-nav__link">
    validateBeforeSave
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#versionkey" class="md-nav__link">
    versionKey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collation" class="md-nav__link">
    collation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skipversioning" class="md-nav__link">
    skipVersioning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timestamps" class="md-nav__link">
    timestamps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usenestedstrict" class="md-nav__link">
    useNestedStrict
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    可插拔
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    接下来
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="_1">模式<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p><a href="http://mongoosejs.com/docs/guide.html" title="Permalink to Mongoose v5.0.1: Schemas">Source</a></p>
<p>If you haven't yet done so, please take a minute to read the <a href="http://mongoosejs.com/index.html">quickstart</a> to get an idea of how Mongoose works. If you are migrating from 4.x to 5.x please take a moment to read the <a href="https://github.com/Automattic/mongoose/blob/master/migrating_to_5.md">migration guide</a>.</p>
<h2 id="_2">定义你的模式<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Everything in Mongoose starts with a Schema. Each schema maps to a MongoDB collection and defines the shape of the documents within that collection.</p>
<div class="highlight"><pre><span></span><code>    <span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">Schema</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">blogSchema</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">Schema</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span>  <span class="nb">String</span><span class="p">,</span>
    <span class="nx">author</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="nx">body</span><span class="o">:</span>   <span class="nb">String</span><span class="p">,</span>
    <span class="nx">comments</span><span class="o">:</span> <span class="p">[{</span> <span class="nx">body</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">date</span><span class="o">:</span> <span class="nb">Date</span> <span class="p">}],</span>
    <span class="nx">date</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span> <span class="p">},</span>
    <span class="nx">hidden</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span>
    <span class="nx">meta</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">votes</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span>
        <span class="nx">favs</span><span class="o">:</span>  <span class="nb">Number</span>
    <span class="p">}</span>
    <span class="p">});</span>
</code></pre></div>
<p>If you want to add additional keys later, use the <a href="http://mongoosejs.com/api.html#schema_Schema-add">Schema#add</a> method.</p>
<p>Each key in our code <code>blogSchema</code> defines a property in our documents which will be cast to its associated <a href="http://mongoosejs.com/api.html#schematype_SchemaType">SchemaType</a>. For example, we've defined a property <code>title</code> which will be cast to the <a href="http://mongoosejs.com/api.html#schema-string-js">String</a> SchemaType and property <code>date</code> which will be cast to a <code>Date</code> SchemaType. Keys may also be assigned nested objects containing further key/type definitions like the <code>meta</code> property above.</p>
<p>The permitted SchemaTypes are:</p>
<ul>
<li>String</li>
<li>Number</li>
<li>Date</li>
<li>Buffer</li>
<li>Boolean</li>
<li>Mixed</li>
<li>ObjectId</li>
<li>Array</li>
</ul>
<p>Read more about <a href="http://mongoosejs.com/schematypes.html">SchemaTypes here</a>.</p>
<p>Schemas not only define the structure of your document and casting of properties, they also define document [instance methods][8], [static Model methods][9], [compound indexes][10], and document lifecycle hooks called <a href="http://mongoosejs.com/middleware.html">middleware</a></p>
<h2 id="_3">创建一个模式<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>To use our schema definition, we need to convert our <code>blogSchema</code> into a <a href="http://mongoosejs.com/models.html">Model</a> we can work with. To do so, we pass it into <code>mongoose.model(modelName, schema)</code>:</p>
<div class="highlight"><pre><span></span><code>    <span class="kd">var</span> <span class="nx">Blog</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Blog&#39;</span><span class="p">,</span> <span class="nx">blogSchema</span><span class="p">);</span>
</code></pre></div>
<h2 id="_4">实例方法<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>Instances of <code>Models</code> are <a href="http://mongoosejs.com/documents.html">documents</a>. Documents have many of their own <a href="http://mongoosejs.com/api.html#document-js">built-in instance methods</a>. We may also define our own custom document instance methods too.</p>
<div class="codehilite"><pre><span></span><code>  <span class="k">var</span> <span class="n">animalSchema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="nb nb-Type">String</span><span class="p">,</span> <span class="n">type</span><span class="p">:</span> <span class="nb nb-Type">String</span> <span class="p">});</span>

  <span class="n">animalSchema</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">findSimilarTypes</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">this</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Animal&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">({</span> <span class="n">type</span><span class="p">:</span> <span class="n">this</span><span class="o">.</span><span class="n">type</span> <span class="p">},</span> <span class="n">cb</span><span class="p">);</span>
  <span class="p">};</span>
</code></pre></div>

<p>Now all of our <code>animal</code> instances have a <code>findSimilarTypes</code> method available to them.</p>
<div class="codehilite"><pre><span></span><code>  <span class="k">var</span> <span class="n">Animal</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Animal&#39;</span><span class="p">,</span> <span class="n">animalSchema</span><span class="p">);</span>
  <span class="k">var</span> <span class="n">dog</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Animal</span><span class="p">({</span> <span class="n">type</span><span class="p">:</span> <span class="s1">&#39;dog&#39;</span> <span class="p">});</span>

  <span class="n">dog</span><span class="o">.</span><span class="n">findSimilarTypes</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">dogs</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dogs</span><span class="p">);</span>
  <span class="p">});</span>
</code></pre></div>

<ul>
<li>Overwriting a default mongoose document method may lead to unpredictable results. See <a href="http://mongoosejs.com/api.html#schema_Schema.reserved">this</a> for more details.</li>
<li>Do <strong>not</strong> declare methods using ES6 arrow functions (<code>=&gt;</code>). Arrow functions <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions#No_binding_of_this">explicitly prevent binding <code>this</code></a>, so your method will <strong>not</strong> have access to the document and the above examples will not work.</li>
</ul>
<h2 id="_5">静态方法<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>Adding static methods to a <code>Model</code> is simple as well. Continuing with our <code>animalSchema</code>:</p>
<div class="codehilite"><pre><span></span><code>  <span class="n">animalSchema</span><span class="o">.</span><span class="n">statics</span><span class="o">.</span><span class="n">findByName</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">this</span><span class="o">.</span><span class="n">find</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="n">new</span> <span class="n">RegExp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">)</span> <span class="p">},</span> <span class="n">cb</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="k">var</span> <span class="n">Animal</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Animal&#39;</span><span class="p">,</span> <span class="n">animalSchema</span><span class="p">);</span>
  <span class="n">Animal</span><span class="o">.</span><span class="n">findByName</span><span class="p">(</span><span class="s1">&#39;fido&#39;</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">animals</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">animals</span><span class="p">);</span>
  <span class="p">});</span>
</code></pre></div>

<p><em>Do <strong>not</strong> declare statics using ES6 arrow functions (<code>=&gt;</code>). Arrow functions <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions#No_binding_of_this">explicitly prevent binding <code>this</code></a>, so the above examples will not work because of the value of <code>this</code>.</em></p>
<h2 id="_6">查询助手<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>You can also add query helper functions, which are like instance methods but for mongoose queries. Query helper methods let you extend mongoose's <a href="http://mongoosejs.com/queries.html">chainable query builder API</a>.</p>
<div class="codehilite"><pre><span></span><code>  <span class="n">animalSchema</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">byName</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">this</span><span class="o">.</span><span class="n">find</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="n">new</span> <span class="n">RegExp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">)</span> <span class="p">});</span>
  <span class="p">};</span>

  <span class="k">var</span> <span class="n">Animal</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Animal&#39;</span><span class="p">,</span> <span class="n">animalSchema</span><span class="p">);</span>
  <span class="n">Animal</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">byName</span><span class="p">(</span><span class="s1">&#39;fido&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">animals</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">animals</span><span class="p">);</span>
  <span class="p">});</span>
</code></pre></div>

<h2 id="_7">索引<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p>MongoDB supports <a href="http://docs.mongodb.org/manual/indexes/">secondary indexes</a>. With mongoose, we define these indexes within our <code>Schema</code> <a href="http://mongoosejs.com/api.html#schematype_SchemaType-index">at</a> <a href="http://mongoosejs.com/api.html#schematype_SchemaType-unique">the</a> <a href="http://mongoosejs.com/api.html#schematype_SchemaType-sparse">path</a> <a href="http://mongoosejs.com/api.html#schema_date_SchemaDate-expires">level</a> or the <code>schema</code> level. Defining indexes at the schema level is necessary when creating <a href="http://www.mongodb.org/display/DOCS/Indexes#Indexes-CompoundKeys">compound indexes</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="nf">var</span><span class="w"> </span><span class="n">animalSchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">Schema</span><span class="p">(</span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nl">tags</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">String</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="k">index</span><span class="err">:</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="err">}</span><span class="w"></span>
<span class="w">  </span><span class="err">}</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">animalSchema</span><span class="p">.</span><span class="k">index</span><span class="p">(</span><span class="err">{</span><span class="w"> </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="err">}</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<p>When your application starts up, Mongoose automatically calls <a href="https://docs.mongodb.com/manual/reference/method/db.collection.createIndex/#db.collection.createIndex"><code>createIndex</code></a> for each defined index in your schema. Mongoose will call <code>createIndex</code> for each index sequentially, and emit an 'index' event on the model when all the <code>createIndex</code> calls succeeded or when there was an error. While nice for development, it is recommended this behavior be disabled in production since index creation can cause a <a href="http://docs.mongodb.org/manual/core/indexes/#index-creation-operations">significant performance impact</a>. Disable the behavior by setting the <code>autoIndex</code> option of your schema to <code>false</code>, or globally on the connection by setting the option <code>autoIndex</code> to <code>false</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="n">mongoose</span><span class="p">.</span><span class="k">connect</span><span class="p">(</span><span class="s1">&#39;mongodb://user:pass@localhost:port/database&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="nl">autoIndex</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="w"> </span><span class="err">}</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">mongoose</span><span class="p">.</span><span class="n">createConnection</span><span class="p">(</span><span class="s1">&#39;mongodb://user:pass@localhost:port/database&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="nl">autoIndex</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="w"> </span><span class="err">}</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">animalSchema</span><span class="p">.</span><span class="k">set</span><span class="p">(</span><span class="s1">&#39;autoIndex&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">false</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="k">new</span><span class="w"> </span><span class="k">Schema</span><span class="p">(</span><span class="err">{</span><span class="p">..</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="nl">autoIndex</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="w"> </span><span class="err">}</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<p>Mongoose will emit an <code>index</code> event on the model when indexes are done building or an error occurred.</p>
<div class="codehilite"><pre><span></span><code>  <span class="n">animalSchema</span><span class="o">.</span><span class="n">index</span><span class="p">({</span> <span class="n">_id</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="p">{</span> <span class="n">sparse</span><span class="p">:</span> <span class="bp">true</span> <span class="p">});</span>
  <span class="k">var</span> <span class="n">Animal</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Animal&#39;</span><span class="p">,</span> <span class="n">animalSchema</span><span class="p">);</span>

  <span class="n">Animal</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">);</span>
  <span class="p">});</span>
</code></pre></div>

<p>See also the <a href="http://mongoosejs.com/api.html#model_Model.ensureIndexes">Model#ensureIndexes</a> method.</p>
<h2 id="_8">虚拟字段<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p><a href="http://mongoosejs.com/api.html#schema_Schema-virtual">Virtuals</a> are document properties that you can get and set but that do not get persisted to MongoDB. The getters are useful for formatting or combining fields, while setters are useful for de-composing a single value into multiple values for storage.</p>
<div class="codehilite"><pre><span></span><code>  <span class="k">var</span> <span class="n">personSchema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span>
    <span class="n">name</span><span class="p">:</span> <span class="p">{</span>
      <span class="n">first</span><span class="p">:</span> <span class="nb nb-Type">String</span><span class="p">,</span>
      <span class="n">last</span><span class="p">:</span> <span class="nb nb-Type">String</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">var</span> <span class="n">Person</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Person&#39;</span><span class="p">,</span> <span class="n">personSchema</span><span class="p">);</span>

  <span class="k">var</span> <span class="n">axl</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Person</span><span class="p">({</span>
    <span class="n">name</span><span class="p">:</span> <span class="p">{</span> <span class="n">first</span><span class="p">:</span> <span class="s1">&#39;Axl&#39;</span><span class="p">,</span> <span class="n">last</span><span class="p">:</span> <span class="s1">&#39;Rose&#39;</span> <span class="p">}</span>
  <span class="p">});</span>
</code></pre></div>

<p>Suppose you want to print out the person's full name. You could do it yourself:</p>
<div class="codehilite"><pre><span></span><code>console.log(axl.name.first + &#39; &#39; + axl.name.last);
</code></pre></div>

<p>But concatenating the first and last name every time can get cumbersome. And what if you want to do some extra processing on the name, like <a href="https://www.npmjs.com/package/diacritics">removing diacritics?</a>. A <a href="http://mongoosejs.com/api.html#virtualtype_VirtualType-get">virtual property getter</a> lets you</p>
<p>define a <code>fullName</code> property that won't get persisted to MongoDB.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">personSchema</span>.<span class="nv">virtual</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">fullName</span><span class="s1">&#39;</span><span class="ss">)</span>.<span class="nv">get</span><span class="ss">(</span><span class="nv">function</span> <span class="ss">()</span> {
  <span class="k">return</span> <span class="nv">this</span>.<span class="nv">name</span>.<span class="nv">first</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="s"> </span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nv">this</span>.<span class="nv">name</span>.<span class="nv">last</span><span class="c1">;</span>
}<span class="ss">)</span><span class="c1">;</span>
</code></pre></div>

<p>Now, mongoose will call your getter function every time you access the <code>fullName</code> property:</p>
<div class="codehilite"><pre><span></span><code>console.log(axl.fullName);
</code></pre></div>

<p>If you use <code>toJSON()</code> or <code>toObject()</code> (or use <code>JSON.stringify()</code> on a mongoose document) mongoose will <em>not</em> include virtuals by default. Pass <code>{ virtuals: true }</code> to either <a href="http://mongoosejs.com/api.html#document_Document-toObject">toObject()</a> or <code>toJSON()</code>.</p>
<p>You can also add a custom setter to your virtual that will let you set both first name and last name via the <code>fullName</code> virtual.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">personSchema</span>.<span class="nv">virtual</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">fullName</span><span class="s1">&#39;</span><span class="ss">)</span>.
  <span class="nv">get</span><span class="ss">(</span><span class="nv">function</span><span class="ss">()</span> { <span class="k">return</span> <span class="nv">this</span>.<span class="nv">name</span>.<span class="nv">first</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="s"> </span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nv">this</span>.<span class="nv">name</span>.<span class="nv">last</span><span class="c1">; }).</span>
  <span class="nv">set</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span><span class="nv">v</span><span class="ss">)</span> {
    <span class="nv">this</span>.<span class="nv">name</span>.<span class="nv">first</span> <span class="o">=</span> <span class="nv">v</span>.<span class="nv">substr</span><span class="ss">(</span><span class="mi">0</span>, <span class="nv">v</span>.<span class="nv">indexOf</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s"> </span><span class="s1">&#39;</span><span class="ss">))</span><span class="c1">;</span>
    <span class="nv">this</span>.<span class="nv">name</span>.<span class="nv">last</span> <span class="o">=</span> <span class="nv">v</span>.<span class="nv">substr</span><span class="ss">(</span><span class="nv">v</span>.<span class="nv">indexOf</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s"> </span><span class="s1">&#39;</span><span class="ss">)</span> <span class="o">+</span> <span class="mi">1</span><span class="ss">)</span><span class="c1">;</span>
  }<span class="ss">)</span><span class="c1">;</span>

<span class="nv">axl</span>.<span class="nv">fullName</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">William Rose</span><span class="s1">&#39;</span><span class="c1">;</span>
</code></pre></div>

<p>Virtual property setters are applied before other validation. So the example above would still work even if the <code>first</code> and <code>last</code> name fields were required.</p>
<p>Only non-virtual properties work as part of queries and for field selection. Since virtuals are not stored in MongoDB, you can't query with them.</p>
<h3 id="_9">别名<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>Aliases are a particular type of virtual where the getter and setter seamlessly get and set another property. This is handy for saving network bandwidth, so you can convert a short property name stored in the database into a longer name for code readability.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">personSchema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span>
  <span class="n">n</span><span class="p">:</span> <span class="p">{</span>
    <span class="n">type</span><span class="p">:</span> <span class="nb nb-Type">String</span><span class="p">,</span>

    <span class="n">alias</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="k">var</span> <span class="n">person</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Person</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;Val&#39;</span> <span class="p">});</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">toObject</span><span class="p">({</span> <span class="n">virtuals</span><span class="p">:</span> <span class="bp">true</span> <span class="p">}));</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="p">);</span>

<span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Not Val&#39;</span><span class="p">;</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
</code></pre></div>

<h2 id="_10">选项<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<p>Schemas have a few configurable options which can be passed to the constructor or <code>set</code> directly:</p>
<div class="codehilite"><pre><span></span><code><span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="n">options</span><span class="p">);</span>

<span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">});</span>
<span class="n">schema</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
</code></pre></div>

<p>Valid options:</p>
<h3 id="autoindex">autoIndex<a class="headerlink" href="#autoindex" title="Permanent link">&para;</a></h3>
<p>At application startup, Mongoose sends a <a href="https://docs.mongodb.com/manual/reference/method/db.collection.createIndex/#db.collection.createIndex"><code>createIndex</code> command</a> for each index declared in your <code>Schema</code>. As of Mongoose v3, indexes are created in the <code>background</code> by default. If you wish to disable the auto-creation feature and manually handle when indexes are created, set your <code>Schema</code>s <code>autoIndex</code> option to <code>false</code> and use the <a href="http://mongoosejs.com/api.html#model_Model.ensureIndexes">ensureIndexes</a> method on your model.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">autoIndex</span><span class="p">:</span> <span class="bp">false</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">Clock</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Clock&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">);</span>
<span class="n">Clock</span><span class="o">.</span><span class="n">ensureIndexes</span><span class="p">(</span><span class="n">callback</span><span class="p">);</span>
</code></pre></div>

<h3 id="buffercommands">bufferCommands<a class="headerlink" href="#buffercommands" title="Permanent link">&para;</a></h3>
<p>By default, mongoose buffers commands when the connection goes down until the driver manages to reconnect. To disable buffering, set <code>bufferCommands</code> to false.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">bufferCommands</span><span class="p">:</span> <span class="bp">false</span> <span class="p">});</span>
</code></pre></div>

<p>The schema <code>bufferCommands</code> option overrides the global <code>bufferCommands</code> option.</p>
<div class="codehilite"><pre><span></span><code><span class="n">mongoose</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;bufferCommands&#39;</span><span class="p">,</span> <span class="bp">true</span><span class="p">);</span>

<span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">bufferCommands</span><span class="p">:</span> <span class="bp">false</span> <span class="p">});</span>
</code></pre></div>

<h3 id="capped">capped<a class="headerlink" href="#capped" title="Permanent link">&para;</a></h3>
<p>Mongoose supports MongoDBs <a href="http://www.mongodb.org/display/DOCS/Capped+Collections">capped</a> collections. To specify the underlying MongoDB collection be <code>capped</code>, set the <code>capped</code> option to the maximum size of the collection in <a href="http://www.mongodb.org/display/DOCS/Capped+Collections#CappedCollections-size.">bytes</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span><span class="err">..</span><span class="p">}</span><span class="o">,</span> <span class="p">{</span> <span class="n">capped</span><span class="p">:</span> <span class="mi">1024</span> <span class="p">}</span><span class="o">);</span>
</code></pre></div>

<p>The <code>capped</code> option may also be set to an object if you want to pass additional options like <a href="http://www.mongodb.org/display/DOCS/Capped+Collections#CappedCollections-max">max</a> or <a href="http://www.mongodb.org/display/DOCS/Capped+Collections#CappedCollections-autoIndexId">autoIndexId</a>. In this case you must explicitly pass the <code>size</code> option, which is required.</p>
<div class="codehilite"><pre><span></span><code><span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span><span class="err">..</span><span class="p">}</span><span class="o">,</span> <span class="p">{</span> <span class="n">capped</span><span class="p">:</span> <span class="err">{</span> <span class="k">size</span><span class="o">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">max</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">autoIndexId</span><span class="o">:</span> <span class="n">true</span> <span class="p">}</span> <span class="err">}</span><span class="o">);</span>
</code></pre></div>

<h3 id="collection">collection<a class="headerlink" href="#collection" title="Permanent link">&para;</a></h3>
<p>Mongoose by default produces a collection name by passing the model name to the <a href="http://mongoosejs.com/api.html#utils_exports.toCollectionName">utils.toCollectionName</a> method. This method pluralizes the name. Set this option if you need a different name for your collection.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">dataSchema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">collection</span><span class="p">:</span> <span class="s1">&#39;data&#39;</span> <span class="p">});</span>
</code></pre></div>

<h3 id="id">id<a class="headerlink" href="#id" title="Permanent link">&para;</a></h3>
<p>Mongoose assigns each of your schemas an <code>id</code> virtual getter by default which returns the documents <code>_id</code> field cast to a string, or in the case of ObjectIds, its hexString. If you don't want an <code>id</code> getter added to your schema, you may disable it passing this option at schema construction time.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="nb nb-Type">String</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">Page</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Page&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">);</span>
<span class="k">var</span> <span class="n">p</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Page</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;mongodb.org&#39;</span> <span class="p">});</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">);</span>

<span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="nb nb-Type">String</span> <span class="p">},</span> <span class="p">{</span> <span class="n">id</span><span class="p">:</span> <span class="bp">false</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">Page</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Page&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">);</span>
<span class="k">var</span> <span class="n">p</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Page</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;mongodb.org&#39;</span> <span class="p">});</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">);</span>
</code></pre></div>

<h3 id="_id">_id<a class="headerlink" href="#_id" title="Permanent link">&para;</a></h3>
<p>Mongoose assigns each of your schemas an <code>_id</code> field by default if one is not passed into the <a href="http://mongoosejs.com/docs/api.html#schema-js">Schema</a> constructor. The type assigned is an <a href="http://mongoosejs.com/docs/api.html#schema_Schema.Types">ObjectId</a> to coincide with MongoDB's default behavior. If you don't want an <code>_id</code> added to your schema at all, you may disable it using this option.</p>
<p>You can <strong>only</strong> use this option on sub-documents. Mongoose can't save a document without knowing its id, so you will get an error if you try to save a document without an <code>_id</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">var</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">Schema</span><span class="p">(</span><span class="err">{</span><span class="w"> </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="err">}</span><span class="p">);</span><span class="w"></span>
<span class="nf">var</span><span class="w"> </span><span class="n">Page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mongoose</span><span class="p">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Page&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">schema</span><span class="p">);</span><span class="w"></span>
<span class="nf">var</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Page</span><span class="p">(</span><span class="err">{</span><span class="w"> </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;mongodb.org&#39;</span><span class="w"> </span><span class="err">}</span><span class="p">);</span><span class="w"></span>
<span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="w"></span>

<span class="nf">var</span><span class="w"> </span><span class="n">childSchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">Schema</span><span class="p">(</span><span class="err">{</span><span class="w"> </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="nl">_id</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="w"> </span><span class="err">}</span><span class="p">);</span><span class="w"></span>
<span class="nf">var</span><span class="w"> </span><span class="n">parentSchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">Schema</span><span class="p">(</span><span class="err">{</span><span class="w"> </span><span class="nl">children</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">childSchema</span><span class="o">]</span><span class="w"> </span><span class="err">}</span><span class="p">);</span><span class="w"></span>

<span class="nf">var</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mongoose</span><span class="p">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Model&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">parentSchema</span><span class="p">);</span><span class="w"></span>

<span class="n">Model</span><span class="p">.</span><span class="k">create</span><span class="p">(</span><span class="err">{</span><span class="w"> </span><span class="nl">children</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">{ name: &#39;Luke&#39; }</span><span class="o">]</span><span class="w"> </span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>

<span class="err">}</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<h3 id="minimize">minimize<a class="headerlink" href="#minimize" title="Permanent link">&para;</a></h3>
<p>Mongoose will, by default, "minimize" schemas by removing empty objects.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="nb nb-Type">String</span><span class="p">,</span> <span class="n">inventory</span><span class="p">:</span> <span class="p">{}</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">Character</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Character&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">);</span>

<span class="k">var</span> <span class="n">frodo</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Character</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;Frodo&#39;</span><span class="p">,</span> <span class="n">inventory</span><span class="p">:</span> <span class="p">{</span> <span class="n">ringOfPower</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}});</span>
<span class="n">Character</span><span class="o">.</span><span class="n">findOne</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;Frodo&#39;</span> <span class="p">},</span> <span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">character</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">character</span><span class="p">);</span>
<span class="p">});</span>

<span class="k">var</span> <span class="n">sam</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Character</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;Sam&#39;</span><span class="p">,</span> <span class="n">inventory</span><span class="p">:</span> <span class="p">{}});</span>
<span class="n">Character</span><span class="o">.</span><span class="n">findOne</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;Sam&#39;</span> <span class="p">},</span> <span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">character</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">character</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p>This behavior can be overridden by setting <code>minimize</code> option to <code>false</code>. It will then store empty objects.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="nb nb-Type">String</span><span class="p">,</span> <span class="n">inventory</span><span class="p">:</span> <span class="p">{}</span> <span class="p">},</span> <span class="p">{</span> <span class="n">minimize</span><span class="p">:</span> <span class="bp">false</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">Character</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Character&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">);</span>

<span class="k">var</span> <span class="n">sam</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Character</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;Sam&#39;</span><span class="p">,</span> <span class="n">inventory</span><span class="p">:</span> <span class="p">{}});</span>
<span class="n">Character</span><span class="o">.</span><span class="n">findOne</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;Sam&#39;</span> <span class="p">},</span> <span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">character</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">character</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="read">read<a class="headerlink" href="#read" title="Permanent link">&para;</a></h3>
<p>Allows setting <a href="http://mongoosejs.com/docs/api.html#query_Query-read">query#read</a> options at the schema level, providing us a way to apply default <a href="http://docs.mongodb.org/manual/applications/replication/#replica-set-read-preference">ReadPreferences</a> to all queries derived from a model.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">read</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">read</span><span class="p">:</span> <span class="s1">&#39;primaryPreferred&#39;</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">read</span><span class="p">:</span> <span class="s1">&#39;secondary&#39;</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">read</span><span class="p">:</span> <span class="s1">&#39;secondaryPreferred&#39;</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">read</span><span class="p">:</span> <span class="s1">&#39;nearest&#39;</span> <span class="p">});</span>
</code></pre></div>

<p>The alias of each pref is also permitted so instead of having to type out 'secondaryPreferred' and getting the spelling wrong, we can simply pass 'sp'.</p>
<p>The read option also allows us to specify <em>tag sets</em>. These tell the <a href="https://github.com/mongodb/node-mongodb-native/">driver</a> from which members of the replica-set it should attempt to read. Read more about tag sets <a href="http://docs.mongodb.org/manual/applications/replication/#tag-sets">here</a> and <a href="http://mongodb.github.com/node-mongodb-native/driver-articles/anintroductionto1_1and2_2.html#read-preferences">here</a>.</p>
<p><em>NOTE: you may also specify the driver read pref <a href="http://mongodb.github.com/node-mongodb-native/api-generated/replset.html?highlight=strategy">strategy</a> option when connecting:</em></p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{</span> <span class="n">replset</span><span class="p">:</span> <span class="p">{</span> <span class="n">strategy</span><span class="p">:</span> <span class="s1">&#39;ping&#39;</span> <span class="p">}};</span>
<span class="n">mongoose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>

<span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">read</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="n">disk</span><span class="p">:</span> <span class="s1">&#39;ssd&#39;</span> <span class="p">}]</span> <span class="p">});</span>
<span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;JellyBean&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">);</span>
</code></pre></div>

<h3 id="shardkey">shardKey<a class="headerlink" href="#shardkey" title="Permanent link">&para;</a></h3>
<p>The <code>shardKey</code> option is used when we have a <a href="http://www.mongodb.org/display/DOCS/Sharding+Introduction">sharded MongoDB architecture</a>. Each sharded collection is given a shard key which must be present in all insert/update operations. We just need to set this schema option to the same shard key and we'll be all set.</p>
<div class="codehilite"><pre><span></span><code>new Schema({ .. }, { shardKey: { tag: 1, name: 1 }})
</code></pre></div>

<p><em>Note that Mongoose does not send the <code>shardcollection</code> command for you. You must configure your shards yourself.</em></p>
<h3 id="strict">strict<a class="headerlink" href="#strict" title="Permanent link">&para;</a></h3>
<p>The strict option, (enabled by default), ensures that values passed to our model constructor that were not specified in our schema do not get saved to the db.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">thingSchema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">})</span>
<span class="k">var</span> <span class="n">Thing</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Thing&#39;</span><span class="p">,</span> <span class="n">thingSchema</span><span class="p">);</span>
<span class="k">var</span> <span class="n">thing</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thing</span><span class="p">({</span> <span class="n">iAmNotInTheSchema</span><span class="p">:</span> <span class="bp">true</span> <span class="p">});</span>
<span class="n">thing</span><span class="o">.</span><span class="n">save</span><span class="p">();</span>

<span class="k">var</span> <span class="n">thingSchema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">strict</span><span class="p">:</span> <span class="bp">false</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">thing</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thing</span><span class="p">({</span> <span class="n">iAmNotInTheSchema</span><span class="p">:</span> <span class="bp">true</span> <span class="p">});</span>
<span class="n">thing</span><span class="o">.</span><span class="n">save</span><span class="p">();</span>
</code></pre></div>

<p>This also affects the use of <code>doc.set()</code> to set a property value.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">thingSchema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">})</span>
<span class="k">var</span> <span class="n">Thing</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Thing&#39;</span><span class="p">,</span> <span class="n">thingSchema</span><span class="p">);</span>
<span class="k">var</span> <span class="n">thing</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thing</span><span class="p">;</span>
<span class="n">thing</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;iAmNotInTheSchema&#39;</span><span class="p">,</span> <span class="bp">true</span><span class="p">);</span>
<span class="n">thing</span><span class="o">.</span><span class="n">save</span><span class="p">();</span>
</code></pre></div>

<p>This value can be overridden at the model instance level by passing a second boolean argument:</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">Thing</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Thing&#39;</span><span class="p">);</span>
<span class="k">var</span> <span class="n">thing</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thing</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="bp">true</span><span class="p">);</span>
<span class="k">var</span> <span class="n">thing</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thing</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="bp">false</span><span class="p">);</span>
</code></pre></div>

<p>The <code>strict</code> option may also be set to <code>"throw"</code> which will cause errors to be produced instead of dropping the bad data.</p>
<p><em>NOTE: Any key/val set on the instance that does not exist in your schema is always ignored, regardless of schema option.</em></p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">thingSchema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">})</span>
<span class="k">var</span> <span class="n">Thing</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Thing&#39;</span><span class="p">,</span> <span class="n">thingSchema</span><span class="p">);</span>
<span class="k">var</span> <span class="n">thing</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thing</span><span class="p">;</span>
<span class="n">thing</span><span class="o">.</span><span class="n">iAmNotInTheSchema</span> <span class="o">=</span> <span class="bp">true</span><span class="p">;</span>
<span class="n">thing</span><span class="o">.</span><span class="n">save</span><span class="p">();</span>
</code></pre></div>

<h3 id="tojson">toJSON<a class="headerlink" href="#tojson" title="Permanent link">&para;</a></h3>
<p>Exactly the same as the [toObject][60] option but only applies when the documents <code>toJSON</code> method is called.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="nb nb-Type">String</span> <span class="p">});</span>
<span class="n">schema</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">function</span> <span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">v</span> <span class="o">+</span> <span class="s1">&#39; is my name&#39;</span><span class="p">;</span>
<span class="p">});</span>
<span class="n">schema</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;toJSON&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="n">getters</span><span class="p">:</span> <span class="bp">true</span><span class="p">,</span> <span class="n">virtuals</span><span class="p">:</span> <span class="bp">false</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">M</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Person&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">);</span>
<span class="k">var</span> <span class="n">m</span> <span class="o">=</span> <span class="n">new</span> <span class="n">M</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;Max Headroom&#39;</span> <span class="p">});</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">toObject</span><span class="p">());</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">toJSON</span><span class="p">());</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">m</span><span class="p">));</span>
</code></pre></div>

<p>To see all available <code>toJSON/toObject</code> options, read <a href="http://mongoosejs.com/docs/api.html#document_Document-toObject">this</a>.</p>
<h3 id="toobject">toObject<a class="headerlink" href="#toobject" title="Permanent link">&para;</a></h3>
<p>Documents have a <a href="http://mongoosejs.com/docs/api.html#document_Document-toObject">toObject</a> method which converts the mongoose document into a plain javascript object. This method accepts a few options. Instead of applying these options on a per-document basis we may declare the options here and have it applied to all of this schemas documents by default.</p>
<p>To have all virtuals show up in your <code>console.log</code> output, set the <code>toObject</code> option to <code>{ getters: true }</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="nb nb-Type">String</span> <span class="p">});</span>
<span class="n">schema</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">function</span> <span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">v</span> <span class="o">+</span> <span class="s1">&#39; is my name&#39;</span><span class="p">;</span>
<span class="p">});</span>
<span class="n">schema</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;toObject&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="n">getters</span><span class="p">:</span> <span class="bp">true</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">M</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Person&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">);</span>
<span class="k">var</span> <span class="n">m</span> <span class="o">=</span> <span class="n">new</span> <span class="n">M</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;Max Headroom&#39;</span> <span class="p">});</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
</code></pre></div>

<p>To see all available <code>toObject</code> options, read <a href="http://mongoosejs.com/docs/api.html#document_Document-toObject">this</a>.</p>
<h3 id="typekey">typeKey<a class="headerlink" href="#typekey" title="Permanent link">&para;</a></h3>
<p>By default, if you have an object with key 'type' in your schema, mongoose will interpret it as a type declaration.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">var</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">Schema</span><span class="p">(</span><span class="err">{</span><span class="w"> </span><span class="nl">loc</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="nl">coordinates</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">Number</span><span class="o">]</span><span class="w"> </span><span class="err">}</span><span class="w"> </span><span class="err">}</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<p>However, for applications like <a href="http://docs.mongodb.org/manual/reference/geojson/">geoJSON</a>, the 'type' property is important. If you want to control which key mongoose uses to find type declarations, set the 'typeKey' schema option.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">var</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">Schema</span><span class="p">(</span><span class="err">{</span><span class="w"></span>

<span class="w">  </span><span class="nl">loc</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="nl">coordinates</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">Number</span><span class="o">]</span><span class="w"> </span><span class="err">}</span><span class="p">,</span><span class="w"></span>

<span class="w">  </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="err">$</span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="err">}</span><span class="w"></span>
<span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="nl">typeKey</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;$type&#39;</span><span class="w"> </span><span class="err">}</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<h3 id="validatebeforesave">validateBeforeSave<a class="headerlink" href="#validatebeforesave" title="Permanent link">&para;</a></h3>
<p>By default, documents are automatically validated before they are saved to the database. This is to prevent saving an invalid document. If you want to handle validation manually, and be able to save objects which don't pass validation, you can set <code>validateBeforeSave</code> to false.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="nb nb-Type">String</span> <span class="p">});</span>
<span class="n">schema</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;validateBeforeSave&#39;</span><span class="p">,</span> <span class="bp">false</span><span class="p">);</span>
<span class="n">schema</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">function</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">v</span> <span class="o">!=</span> <span class="nb nb-Type">null</span><span class="p">;</span>
<span class="p">});</span>
<span class="k">var</span> <span class="n">M</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Person&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">);</span>
<span class="k">var</span> <span class="n">m</span> <span class="o">=</span> <span class="n">new</span> <span class="n">M</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="nb nb-Type">null</span> <span class="p">});</span>
<span class="n">m</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>
<span class="p">});</span>
<span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">();</span>
</code></pre></div>

<h3 id="versionkey">versionKey<a class="headerlink" href="#versionkey" title="Permanent link">&para;</a></h3>
<p>The <code>versionKey</code> is a property set on each document when first created by Mongoose. This keys value contains the internal <a href="http://aaronheckmann.tumblr.com/post/48943525537/mongoose-v3-part-1-versioning">revision</a> of the document. The <code>versionKey</code> option is a string that represents the path to use for versioning. The default is <code>__v</code>. If this conflicts with your application you can configure as such:</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">Thing</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Thing&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">);</span>
<span class="k">var</span> <span class="n">thing</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thing</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;mongoose v3&#39;</span> <span class="p">});</span>
<span class="n">thing</span><span class="o">.</span><span class="n">save</span><span class="p">();</span>

<span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">versionKey</span><span class="p">:</span> <span class="s1">&#39;_somethingElse&#39;</span> <span class="p">})</span>
<span class="k">var</span> <span class="n">Thing</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Thing&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">);</span>
<span class="k">var</span> <span class="n">thing</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thing</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;mongoose v3&#39;</span> <span class="p">});</span>
<span class="n">thing</span><span class="o">.</span><span class="n">save</span><span class="p">();</span>
</code></pre></div>

<p>Document versioning can also be disabled by setting the <code>versionKey</code> to <code>false</code>. <em>DO NOT disable versioning unless you <a href="http://aaronheckmann.tumblr.com/post/48943525537/mongoose-v3-part-1-versioning">know what you are doing</a>.</em></p>
<div class="codehilite"><pre><span></span><code><span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">versionKey</span><span class="p">:</span> <span class="bp">false</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">Thing</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Thing&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">);</span>
<span class="k">var</span> <span class="n">thing</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thing</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;no versioning please&#39;</span> <span class="p">});</span>
<span class="n">thing</span><span class="o">.</span><span class="n">save</span><span class="p">();</span>
</code></pre></div>

<h3 id="collation">collation<a class="headerlink" href="#collation" title="Permanent link">&para;</a></h3>
<p>Sets a default <a href="https://docs.mongodb.com/manual/reference/collation/">collation</a> for every query and aggregation. <a href="http://thecodebarbarian.com/a-nodejs-perspective-on-mongodb-34-collations">Here's a beginner-friendly overview of collations</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span>
  <span class="n">name</span><span class="p">:</span> <span class="nb nb-Type">String</span>
<span class="p">},</span> <span class="p">{</span> <span class="n">collation</span><span class="p">:</span> <span class="p">{</span> <span class="n">locale</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="n">strength</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">});</span>

<span class="k">var</span> <span class="n">MyModel</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;MyModel&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">);</span>

<span class="n">MyModel</span><span class="o">.</span><span class="n">create</span><span class="p">([{</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;val&#39;</span> <span class="p">},</span> <span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;Val&#39;</span> <span class="p">}])</span><span class="o">.</span>
  <span class="n">then</span><span class="p">(</span><span class="n">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">find</span><span class="p">({</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;val&#39;</span> <span class="p">});</span>
  <span class="p">})</span><span class="o">.</span>
  <span class="n">then</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">});</span>
</code></pre></div>

<h3 id="skipversioning">skipVersioning<a class="headerlink" href="#skipversioning" title="Permanent link">&para;</a></h3>
<p><code>skipVersioning</code> allows excluding paths from versioning (i.e., the internal revision will not be incremented even if these paths are updated). DO NOT do this unless you know what you're doing. For sub-documents, include this on the parent document using the fully qualified path.</p>
<div class="codehilite"><pre><span></span><code><span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span><span class="err">..</span><span class="p">}</span><span class="o">,</span> <span class="p">{</span> <span class="n">skipVersioning</span><span class="p">:</span> <span class="err">{</span> <span class="n">dontVersionMe</span><span class="o">:</span> <span class="n">true</span> <span class="p">}</span> <span class="err">}</span><span class="o">);</span>
<span class="nt">thing</span><span class="p">.</span><span class="nc">dontVersionMe</span><span class="p">.</span><span class="nc">push</span><span class="o">(</span><span class="s1">&#39;hey&#39;</span><span class="o">);</span>
<span class="nt">thing</span><span class="p">.</span><span class="nc">save</span><span class="o">();</span>
</code></pre></div>

<h3 id="timestamps">timestamps<a class="headerlink" href="#timestamps" title="Permanent link">&para;</a></h3>
<p>If set <code>timestamps</code>, mongoose assigns <code>createdAt</code> and <code>updatedAt</code> fields to your schema, the type assigned is <a href="http://mongoosejs.com/docs/api.html#schema-date-js">Date</a>.</p>
<p>By default, the name of two fields are <code>createdAt</code> and <code>updatedAt</code>, customize the field name by setting <code>timestamps.createdAt</code> and <code>timestamps.updatedAt</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">thingSchema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span><span class="o">..</span><span class="p">},</span> <span class="p">{</span> <span class="n">timestamps</span><span class="p">:</span> <span class="p">{</span> <span class="n">createdAt</span><span class="p">:</span> <span class="s1">&#39;created_at&#39;</span> <span class="p">}</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">Thing</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Thing&#39;</span><span class="p">,</span> <span class="n">thingSchema</span><span class="p">);</span>
<span class="k">var</span> <span class="n">thing</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thing</span><span class="p">();</span>
<span class="n">thing</span><span class="o">.</span><span class="n">save</span><span class="p">();</span>
</code></pre></div>

<h3 id="usenestedstrict">useNestedStrict<a class="headerlink" href="#usenestedstrict" title="Permanent link">&para;</a></h3>
<p>In mongoose 4, <code>update()</code> and <code>findOneAndUpdate()</code> only check the top-level schema's strict mode setting.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">childSchema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({},</span> <span class="p">{</span> <span class="n">strict</span><span class="p">:</span> <span class="bp">false</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">parentSchema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span> <span class="n">child</span><span class="p">:</span> <span class="n">childSchema</span> <span class="p">},</span> <span class="p">{</span> <span class="n">strict</span><span class="p">:</span> <span class="s1">&#39;throw&#39;</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">Parent</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">parentSchema</span><span class="p">);</span>
<span class="n">Parent</span><span class="o">.</span><span class="n">update</span><span class="p">({},</span> <span class="p">{</span> <span class="s1">&#39;child.name&#39;</span><span class="p">:</span> <span class="s1">&#39;Luke Skywalker&#39;</span> <span class="p">},</span> <span class="n">function</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

<span class="p">});</span>

<span class="k">var</span> <span class="n">update</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;child.name&#39;</span><span class="p">:</span> <span class="s1">&#39;Luke Skywalker&#39;</span> <span class="p">};</span>
<span class="k">var</span> <span class="n">opts</span> <span class="o">=</span> <span class="p">{</span> <span class="n">strict</span><span class="p">:</span> <span class="bp">false</span> <span class="p">};</span>
<span class="n">Parent</span><span class="o">.</span><span class="n">update</span><span class="p">({},</span> <span class="n">update</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

<span class="p">});</span>
</code></pre></div>

<p>If you set <code>useNestedStrict</code> to true, mongoose will use the child schema's <code>strict</code> option for casting updates.</p>
<div class="codehilite"><pre><span></span><code><span class="k">var</span> <span class="n">childSchema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({},</span> <span class="p">{</span> <span class="n">strict</span><span class="p">:</span> <span class="bp">false</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">parentSchema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">({</span> <span class="n">child</span><span class="p">:</span> <span class="n">childSchema</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">strict</span><span class="p">:</span> <span class="s1">&#39;throw&#39;</span><span class="p">,</span> <span class="n">useNestedStrict</span><span class="p">:</span> <span class="bp">true</span> <span class="p">});</span>
<span class="k">var</span> <span class="n">Parent</span> <span class="o">=</span> <span class="n">mongoose</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">parentSchema</span><span class="p">);</span>
<span class="n">Parent</span><span class="o">.</span><span class="n">update</span><span class="p">({},</span> <span class="p">{</span> <span class="s1">&#39;child.name&#39;</span><span class="p">:</span> <span class="s1">&#39;Luke Skywalker&#39;</span> <span class="p">},</span> <span class="n">function</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

<span class="p">});</span>
</code></pre></div>

<h2 id="_11">可插拔<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<p>Schema也是<a href="http://mongoosejs.com/plugins.html">可插拔</a>，它允许我们将可重用的特性打包成可与社区共享或只在您的项目之间共享的插件。</p>
<h2 id="_12">接下来<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<p>现在我们已经介绍了模式，我们来看看<a href="http://mongoosejs.com/docs/schematypes.html">模式类型</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../connection/api/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 连接API" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              连接API
            </div>
          </div>
        </a>
      
      
        
        <a href="../api/" class="md-footer__link md-footer__link--next" aria-label="下一页: 模式API" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              模式API
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            版权 &copy; 2018 -  wohugb.github.io
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="http://wohugb.github.io" target="_blank" rel="noopener" title="wohugb.github.io" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://github.com/wohugb" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/wohugb" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://linkedin.com/in/wohugb" target="_blank" rel="noopener" title="linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.e99e714c.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.bc35569b.min.js"></script>
      
    
  </body>
</html>