



<!DOCTYPE html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Mongodb NodeJs 组件中文文档">
      
      
      
        <meta name="author" content="Nosy">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="zh">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.5">
    
    
      
        <title>模式类型API - Mongoose文档</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.bcabdff3.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="indigo" data-md-color-accent="indigo">
    
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Mongoose文档" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Mongoose文档
              </span>
              <span class="md-header-nav__topic">
                模式类型API
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/wohugb/mongoose-docs" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      wohugb/mongoose-docs
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="前言" class="md-tabs__link">
        前言
      </a>
    
  </li>

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../connection/guide/" title="连接" class="md-tabs__link">
          连接
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../guide/" title="模式" class="md-tabs__link md-tabs__link--active">
          模式
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../model/guide/" title="模型" class="md-tabs__link">
          模型
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../document/guide/" title="文档" class="md-tabs__link">
          文档
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../query/guide/" title="查询" class="md-tabs__link">
          查询
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../guide/Validation/" title="其它手册" class="md-tabs__link">
          其它手册
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../api/Aggregate/" title="其它API" class="md-tabs__link">
          其它API
        </a>
      
    </li>
  

      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Mongoose文档
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/wohugb/mongoose-docs" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      wohugb/mongoose-docs
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="前言" class="md-nav__link">
      前言
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../QuickStart/" title="快速开始" class="md-nav__link">
      快速开始
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      连接
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        连接
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../connection/guide/" title="连接手册" class="md-nav__link">
      连接手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../connection/api/" title="连接API" class="md-nav__link">
      连接API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      模式
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        模式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../guide/" title="模式手册" class="md-nav__link">
      模式手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/" title="模式API" class="md-nav__link">
      模式API
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        模式类型API
      </label>
    
    <a href="./" title="模式类型API" class="md-nav__link md-nav__link--active">
      模式类型API
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#schematype" title="SchemaType()" class="md-nav__link">
    SchemaType()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypedefault" title="SchemaType.prototype.default()" class="md-nav__link">
    SchemaType.prototype.default()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypeindex" title="SchemaType.prototype.index()" class="md-nav__link">
    SchemaType.prototype.index()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypeunique" title="SchemaType.prototype.unique()" class="md-nav__link">
    SchemaType.prototype.unique()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypetext" title="SchemaType.prototype.text()" class="md-nav__link">
    SchemaType.prototype.text()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypesparse" title="SchemaType.prototype.sparse()" class="md-nav__link">
    SchemaType.prototype.sparse()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypeset" title="SchemaType.prototype.set()" class="md-nav__link">
    SchemaType.prototype.set()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypeget" title="SchemaType.prototype.get()" class="md-nav__link">
    SchemaType.prototype.get()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypevalidate" title="SchemaType.prototype.validate()" class="md-nav__link">
    SchemaType.prototype.validate()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototyperequired" title="SchemaType.prototype.required()" class="md-nav__link">
    SchemaType.prototype.required()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypeselect" title="SchemaType.prototype.select()" class="md-nav__link">
    SchemaType.prototype.select()
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      模型
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        模型
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../model/guide/" title="模型手册" class="md-nav__link">
      模型手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../model/api/" title="模型API" class="md-nav__link">
      模型API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      文档
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        文档
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../document/guide/" title="文档手册" class="md-nav__link">
      文档手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../document/api/" title="文档API" class="md-nav__link">
      文档API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      查询
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        查询
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../query/guide/" title="查询手册" class="md-nav__link">
      查询手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../query/api/" title="查询API" class="md-nav__link">
      查询API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      其它手册
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        其它手册
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/Validation/" title="验证" class="md-nav__link">
      验证
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/Middleware/" title="中间件" class="md-nav__link">
      中间件
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/Populate/" title="填充" class="md-nav__link">
      填充
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/Discriminators/" title="鉴别器" class="md-nav__link">
      鉴别器
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/Plugins/" title="插件" class="md-nav__link">
      插件
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      其它API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        其它API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/Aggregate/" title="聚合" class="md-nav__link">
      聚合
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/VirtualType/" title="虚拟类型" class="md-nav__link">
      虚拟类型
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/Error/" title="错误" class="md-nav__link">
      错误
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../VersionCompatibility/" title="版本兼容性" class="md-nav__link">
      版本兼容性
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../FAQ/" title="常问问题" class="md-nav__link">
      常问问题
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#schematype" title="SchemaType()" class="md-nav__link">
    SchemaType()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypedefault" title="SchemaType.prototype.default()" class="md-nav__link">
    SchemaType.prototype.default()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypeindex" title="SchemaType.prototype.index()" class="md-nav__link">
    SchemaType.prototype.index()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypeunique" title="SchemaType.prototype.unique()" class="md-nav__link">
    SchemaType.prototype.unique()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypetext" title="SchemaType.prototype.text()" class="md-nav__link">
    SchemaType.prototype.text()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypesparse" title="SchemaType.prototype.sparse()" class="md-nav__link">
    SchemaType.prototype.sparse()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypeset" title="SchemaType.prototype.set()" class="md-nav__link">
    SchemaType.prototype.set()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypeget" title="SchemaType.prototype.get()" class="md-nav__link">
    SchemaType.prototype.get()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypevalidate" title="SchemaType.prototype.validate()" class="md-nav__link">
    SchemaType.prototype.validate()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototyperequired" title="SchemaType.prototype.required()" class="md-nav__link">
    SchemaType.prototype.required()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schematypeprototypeselect" title="SchemaType.prototype.select()" class="md-nav__link">
    SchemaType.prototype.select()
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="_1">模式类型<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="schematype">SchemaType()<a class="headerlink" href="#schematype" title="Permanent link">&para;</a></h2>
<p><strong>参数</strong></p>
<p>SchemaType constructor. Do <strong>not</strong> instantiate <code>SchemaType</code> directly. Mongoose converts your schema paths into SchemaTypes automatically.</p>
<p><strong>示例</strong></p>
<div class="codehilite"><pre><span></span><span class="nt">const</span> <span class="nt">schema</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="n">String</span> <span class="p">}</span><span class="o">);</span>
<span class="nt">schema</span><span class="p">.</span><span class="nc">path</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">)</span> <span class="nt">instanceof</span> <span class="nt">SchemaType</span><span class="o">;</span>
</pre></div>


<h2 id="schematypeprototypedefault">SchemaType.prototype.default()<a class="headerlink" href="#schematypeprototypedefault" title="Permanent link">&para;</a></h2>
<p><strong>参数</strong></p>
<ul>
<li>val «Function,any» the default value</li>
</ul>
<p><strong>返回</strong></p>
<p>Sets a default value for this SchemaType.</p>
<p><strong>示例</strong></p>
<div class="codehilite"><pre><span></span>var schema = new Schema({ n: { type: Number, default: 10 })
var M = db.model(&#39;M&#39;, schema)
var m = new M;
console.log(m.n)
</pre></div>


<p>Defaults can be either <code>functions</code> which return the value to use as the default or the literal value itself. Either way, the value will be cast based on its schema type before being set during document creation.</p>
<p><strong>示例</strong></p>
<div class="codehilite"><pre><span></span><span class="nt">var</span> <span class="nt">schema</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">aNumber</span><span class="p">:</span> <span class="err">{</span> <span class="n">type</span><span class="o">:</span> <span class="n">Number</span><span class="p">,</span> <span class="kc">default</span><span class="o">:</span> <span class="mf">4.815162342</span> <span class="p">}</span><span class="err">}</span><span class="o">)</span>
<span class="nt">var</span> <span class="nt">M</span> <span class="o">=</span> <span class="nt">db</span><span class="p">.</span><span class="nc">model</span><span class="o">(</span><span class="s1">&#39;M&#39;</span><span class="o">,</span> <span class="nt">schema</span><span class="o">)</span>
<span class="nt">var</span> <span class="nt">m</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">M</span><span class="o">;</span>
<span class="nt">console</span><span class="p">.</span><span class="nc">log</span><span class="o">(</span><span class="nt">m</span><span class="p">.</span><span class="nc">aNumber</span><span class="o">)</span>

<span class="nt">var</span> <span class="nt">schema</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">mixed</span><span class="p">:</span> <span class="n">Schema</span><span class="o">.</span><span class="n">Types</span><span class="o">.</span><span class="n">Mixed</span> <span class="p">}</span><span class="o">);</span>
<span class="nt">schema</span><span class="p">.</span><span class="nc">path</span><span class="o">(</span><span class="s1">&#39;mixed&#39;</span><span class="o">)</span><span class="p">.</span><span class="nc">default</span><span class="o">(</span><span class="nt">function</span> <span class="o">()</span> <span class="p">{</span>
  <span class="err">return</span> <span class="err">{</span><span class="p">}</span><span class="o">;</span>
<span class="err">}</span><span class="o">);</span>

<span class="nt">var</span> <span class="nt">schema</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">mixed</span><span class="p">:</span> <span class="n">Schema</span><span class="o">.</span><span class="n">Types</span><span class="o">.</span><span class="n">Mixed</span> <span class="p">}</span><span class="o">);</span>
<span class="nt">schema</span><span class="p">.</span><span class="nc">path</span><span class="o">(</span><span class="s1">&#39;mixed&#39;</span><span class="o">)</span><span class="p">.</span><span class="nc">default</span><span class="o">(</span><span class="p">{}</span><span class="o">);</span>
<span class="nt">var</span> <span class="nt">M</span> <span class="o">=</span> <span class="nt">db</span><span class="p">.</span><span class="nc">model</span><span class="o">(</span><span class="s1">&#39;M&#39;</span><span class="o">,</span> <span class="nt">schema</span><span class="o">);</span>
<span class="nt">var</span> <span class="nt">m1</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">M</span><span class="o">;</span>
<span class="nt">m1</span><span class="p">.</span><span class="nc">mixed</span><span class="p">.</span><span class="nc">added</span> <span class="o">=</span> <span class="nt">1</span><span class="o">;</span>
<span class="nt">console</span><span class="p">.</span><span class="nc">log</span><span class="o">(</span><span class="nt">m1</span><span class="p">.</span><span class="nc">mixed</span><span class="o">);</span>
<span class="nt">var</span> <span class="nt">m2</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">M</span><span class="o">;</span>
<span class="nt">console</span><span class="p">.</span><span class="nc">log</span><span class="o">(</span><span class="nt">m2</span><span class="p">.</span><span class="nc">mixed</span><span class="o">);</span>
</pre></div>


<h2 id="schematypeprototypeindex">SchemaType.prototype.index()<a class="headerlink" href="#schematypeprototypeindex" title="Permanent link">&para;</a></h2>
<p><strong>参数</strong></p>
<ul>
<li>options «Object,Boolean,String»</li>
</ul>
<p><strong>返回</strong></p>
<p>Declares the index options for this schematype.</p>
<p><strong>示例</strong></p>
<div class="codehilite"><pre><span></span><span class="nt">var</span> <span class="nt">s</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="err">{</span> <span class="n">type</span><span class="o">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">index</span><span class="o">:</span> <span class="n">true</span> <span class="p">}</span><span class="o">)</span>
<span class="nt">var</span> <span class="nt">s</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">loc</span><span class="p">:</span> <span class="err">{</span> <span class="n">type</span><span class="o">:</span> <span class="cp">[</span><span class="nx">Number</span><span class="cp">]</span><span class="p">,</span> <span class="n">index</span><span class="o">:</span> <span class="s1">&#39;hashed&#39;</span> <span class="p">}</span><span class="o">)</span>
<span class="nt">var</span> <span class="nt">s</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">loc</span><span class="p">:</span> <span class="err">{</span> <span class="n">type</span><span class="o">:</span> <span class="cp">[</span><span class="nx">Number</span><span class="cp">]</span><span class="p">,</span> <span class="n">index</span><span class="o">:</span> <span class="s1">&#39;2d&#39;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">:</span> <span class="n">true</span> <span class="p">}</span><span class="o">)</span>
<span class="nt">var</span> <span class="nt">s</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">loc</span><span class="p">:</span> <span class="err">{</span> <span class="n">type</span><span class="o">:</span> <span class="cp">[</span><span class="nx">Number</span><span class="cp">]</span><span class="p">,</span> <span class="n">index</span><span class="o">:</span> <span class="err">{</span> <span class="n">type</span><span class="o">:</span> <span class="s1">&#39;2dsphere&#39;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">:</span> <span class="n">true</span> <span class="p">}</span><span class="err">}</span><span class="o">)</span>
<span class="nt">var</span> <span class="nt">s</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">date</span><span class="p">:</span> <span class="err">{</span> <span class="n">type</span><span class="o">:</span> <span class="n">Date</span><span class="p">,</span> <span class="n">index</span><span class="o">:</span> <span class="err">{</span> <span class="n">unique</span><span class="o">:</span> <span class="n">true</span><span class="p">,</span> <span class="n">expires</span><span class="o">:</span> <span class="s1">&#39;1d&#39;</span> <span class="p">}</span><span class="err">}</span><span class="o">)</span>
<span class="nt">Schema</span><span class="p">.</span><span class="nc">path</span><span class="o">(</span><span class="s1">&#39;my.path&#39;</span><span class="o">)</span><span class="p">.</span><span class="nc">index</span><span class="o">(</span><span class="nt">true</span><span class="o">);</span>
<span class="nt">Schema</span><span class="p">.</span><span class="nc">path</span><span class="o">(</span><span class="s1">&#39;my.date&#39;</span><span class="o">)</span><span class="p">.</span><span class="nc">index</span><span class="o">(</span><span class="p">{</span> <span class="n">expires</span><span class="p">:</span> <span class="mi">60</span> <span class="p">}</span><span class="o">);</span>
<span class="nt">Schema</span><span class="p">.</span><span class="nc">path</span><span class="o">(</span><span class="s1">&#39;my.path&#39;</span><span class="o">)</span><span class="p">.</span><span class="nc">index</span><span class="o">(</span><span class="p">{</span> <span class="n">unique</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="n">sparse</span><span class="o">:</span> <span class="n">true</span> <span class="p">}</span><span class="o">);</span>
</pre></div>


<p><strong>注释</strong></p>
<p><em>Indexes are created in the background by default. Specify <code>background: false</code> to override.</em></p>
<p>[Direction doesn't matter for single key indexes</p>
<h2 id="schematypeprototypeunique">SchemaType.prototype.unique()<a class="headerlink" href="#schematypeprototypeunique" title="Permanent link">&para;</a></h2>
<p><strong>参数</strong></p>
<p><strong>返回</strong></p>
<p>Declares an unique index.</p>
<p><strong>示例</strong></p>
<div class="codehilite"><pre><span></span><span class="nt">var</span> <span class="nt">s</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="err">{</span> <span class="n">type</span><span class="o">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">unique</span><span class="o">:</span> <span class="n">true</span> <span class="p">}</span><span class="err">}</span><span class="o">);</span>
<span class="nt">Schema</span><span class="p">.</span><span class="nc">path</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">)</span><span class="p">.</span><span class="nc">index</span><span class="o">(</span><span class="p">{</span> <span class="n">unique</span><span class="p">:</span> <span class="n">true</span> <span class="p">}</span><span class="o">);</span>
</pre></div>


<p><em>NOTE: violating the constraint returns an <code>E11000</code> error from MongoDB when saving, not a Mongoose validation error.</em></p>
<h2 id="schematypeprototypetext">SchemaType.prototype.text()<a class="headerlink" href="#schematypeprototypetext" title="Permanent link">&para;</a></h2>
<p><strong>参数</strong></p>
<p><strong>返回</strong></p>
<p>Declares a full text index.</p>
<p><strong>示例</strong></p>
<div class="codehilite"><pre><span></span>var s = new Schema({name : {type: String, text : true })
 Schema.path(&#39;name&#39;).index({text : true});
</pre></div>


<h2 id="schematypeprototypesparse">SchemaType.prototype.sparse()<a class="headerlink" href="#schematypeprototypesparse" title="Permanent link">&para;</a></h2>
<p><strong>参数</strong></p>
<p><strong>返回</strong></p>
<p>Declares a sparse index.</p>
<p><strong>示例</strong></p>
<div class="codehilite"><pre><span></span><span class="nt">var</span> <span class="nt">s</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="err">{</span> <span class="n">type</span><span class="o">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">sparse</span><span class="o">:</span> <span class="n">true</span> <span class="p">}</span><span class="o">)</span>
<span class="nt">Schema</span><span class="p">.</span><span class="nc">path</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">)</span><span class="p">.</span><span class="nc">index</span><span class="o">(</span><span class="p">{</span> <span class="n">sparse</span><span class="p">:</span> <span class="n">true</span> <span class="p">}</span><span class="o">);</span>
</pre></div>


<h2 id="schematypeprototypeset">SchemaType.prototype.set()<a class="headerlink" href="#schematypeprototypeset" title="Permanent link">&para;</a></h2>
<p><strong>参数</strong></p>
<p><strong>返回</strong></p>
<p>Adds a setter to this schematype.</p>
<p><strong>示例</strong></p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">capitalize</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">val</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">val</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">String</span><span class="p">,</span> <span class="nx">set</span>: <span class="kt">capitalize</span> <span class="p">}})</span>

<span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span> <span class="nx">name</span>: <span class="kt">String</span> <span class="p">})</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="nx">capitalize</span><span class="p">)</span>
</pre></div>


<p>Setters allow you to transform the data before it gets to the raw mongodb document and is set as a value on an actual key.</p>
<p>Suppose you are implementing user registration for a website. Users provide an email and password, which gets saved to mongodb. The email is a string that you will want to normalize to lower case, in order to avoid one email having more than one account -- e.g., otherwise, [avenue@q.com can be registered for 2 accounts via [avenue@q.com and [AvEnUe@Q.CoM.</p>
<p>You can set up email lower case normalization easily via a Mongoose setter.</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">toLower</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">v</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">UserSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
  <span class="nx">email</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">String</span><span class="p">,</span> <span class="nx">set</span>: <span class="kt">toLower</span> <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="nx">UserSchema</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">({</span><span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;[AVENUE@Q.COM&#39;</span><span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">);</span> <span class="c1">// &#39;[avenue@q.com&#39;</span>

<span class="c1">// or</span>
<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="s1">&#39;[Avenue@Q.com&#39;</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">);</span> <span class="c1">// &#39;[avenue@q.com&#39;</span>
<span class="nx">User</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span> <span class="nx">_id</span>: <span class="kt">_id</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">$set</span><span class="o">:</span> <span class="p">{</span> <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;[AVENUE@Q.COM&#39;</span> <span class="p">}</span> <span class="p">});</span> <span class="c1">// update to &#39;[avenue@q.com&#39;</span>
</pre></div>


<p>As you can see above, setters allow you to transform the data before it stored in MongoDB.</p>
<p><em>NOTE: we could have also just used the built-in <code>lowercase: true</code> SchemaType option instead of defining our own function.</em></p>
<div class="codehilite"><pre><span></span>new Schema({ email: { type: String, lowercase: true }})
</pre></div>


<p>Setters are also passed a second argument, the schematype on which the setter was defined. This allows for tailored behavior based on options passed in the schema.</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">inspector</span> <span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">schematype</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">schematype</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">required</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">schematype</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39; is required&#39;</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">VirusSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">String</span><span class="p">,</span> <span class="nx">required</span>: <span class="kt">true</span><span class="p">,</span> <span class="nx">set</span>: <span class="kt">inspector</span> <span class="p">},</span>
  <span class="nx">taxonomy</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">String</span><span class="p">,</span> <span class="nx">set</span>: <span class="kt">inspector</span> <span class="p">}</span>
<span class="p">})</span>

<span class="kd">var</span> <span class="nx">Virus</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Virus&#39;</span><span class="p">,</span> <span class="nx">VirusSchema</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Virus</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Parvoviridae&#39;</span><span class="p">,</span> <span class="nx">taxonomy</span><span class="o">:</span> <span class="s1">&#39;Parvovirinae&#39;</span> <span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">taxonomy</span><span class="p">);</span>
</pre></div>


<h2 id="schematypeprototypeget">SchemaType.prototype.get()<a class="headerlink" href="#schematypeprototypeget" title="Permanent link">&para;</a></h2>
<p><strong>参数</strong></p>
<p><strong>返回</strong></p>
<p>Adds a getter to this schematype.</p>
<p><strong>示例</strong></p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">dob</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">val</span><span class="p">)</span> <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">val</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">val</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span> <span class="nx">born</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">Date</span><span class="p">,</span> <span class="nx">get</span>: <span class="kt">dob</span> <span class="p">})</span>

<span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span> <span class="nx">born</span>: <span class="kt">Date</span> <span class="p">})</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s1">&#39;born&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="nx">dob</span><span class="p">)</span>
</pre></div>


<p>Getters allow you to transform the representation of the data as it travels from the raw mongodb document to the value that you see.</p>
<p>Suppose you are storing credit card numbers and you want to hide everything except the last 4 digits to the mongoose user. You can do so by defining a getter in the following way:</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">obfuscate</span> <span class="p">(</span><span class="nx">cc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s1">&#39;****-****-****-&#39;</span> <span class="o">+</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">AccountSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
  <span class="nx">creditCardNumber</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">String</span><span class="p">,</span> <span class="nx">get</span>: <span class="kt">obfuscate</span> <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">Account</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="nx">AccountSchema</span><span class="p">);</span>

<span class="nx">Account</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">found</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">found</span><span class="p">.</span><span class="nx">creditCardNumber</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>


<p>Getters are also passed a second argument, the schematype on which the getter was defined. This allows for tailored behavior based on options passed in the schema.</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">inspector</span> <span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">schematype</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">schematype</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">required</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">schematype</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39; is required&#39;</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">schematype</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39; is not&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">VirusSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">String</span><span class="p">,</span> <span class="nx">required</span>: <span class="kt">true</span><span class="p">,</span> <span class="nx">get</span>: <span class="kt">inspector</span> <span class="p">},</span>
  <span class="nx">taxonomy</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">String</span><span class="p">,</span> <span class="nx">get</span>: <span class="kt">inspector</span> <span class="p">}</span>
<span class="p">})</span>

<span class="kd">var</span> <span class="nx">Virus</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Virus&#39;</span><span class="p">,</span> <span class="nx">VirusSchema</span><span class="p">);</span>

<span class="nx">Virus</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">virus</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">virus</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">virus</span><span class="p">.</span><span class="nx">taxonomy</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>


<h2 id="schematypeprototypevalidate">SchemaType.prototype.validate()<a class="headerlink" href="#schematypeprototypevalidate" title="Permanent link">&para;</a></h2>
<p><strong>参数</strong></p>
<ul>
<li>[type] «String» optional validator type</li>
</ul>
<p><strong>返回</strong></p>
<p>Adds validator(s) for this document path.</p>
<p>Validators always receive the value to validate as their first argument and must return <code>Boolean</code>. Returning <code>false</code> means validation failed.</p>
<p>The error message argument is optional. If not passed, the [default generic error message template will be used.</p>
<p><strong>示例</strong></p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">validator</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">val</span> <span class="o">==</span> <span class="s1">&#39;something&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">String</span><span class="p">,</span> <span class="nx">validate</span>: <span class="kt">validator</span> <span class="p">}});</span>

<span class="kd">var</span> <span class="nx">custom</span> <span class="o">=</span> <span class="p">[</span><span class="nx">validator</span><span class="p">,</span> <span class="s1">&#39;Uh oh, {PATH} does not equal &quot;something&quot;.&#39;</span><span class="p">]</span>
<span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">String</span><span class="p">,</span> <span class="nx">validate</span>: <span class="kt">custom</span> <span class="p">}});</span>

<span class="kd">var</span> <span class="nx">many</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nx">validator</span>: <span class="kt">validator</span><span class="p">,</span> <span class="nx">msg</span><span class="o">:</span> <span class="s1">&#39;uh oh&#39;</span> <span class="p">}</span>
  <span class="p">,</span> <span class="p">{</span> <span class="nx">validator</span>: <span class="kt">anotherValidator</span><span class="p">,</span> <span class="nx">msg</span><span class="o">:</span> <span class="s1">&#39;failed&#39;</span> <span class="p">}</span>
<span class="p">]</span>
<span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">String</span><span class="p">,</span> <span class="nx">validate</span>: <span class="kt">many</span> <span class="p">}});</span>

<span class="kd">var</span> <span class="nx">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;string&#39;</span> <span class="p">});</span>
<span class="nx">schema</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">).</span><span class="nx">validate</span><span class="p">(</span><span class="nx">validator</span><span class="p">,</span> <span class="s1">&#39;validation of `{PATH}` failed with value `{VALUE}`&#39;</span><span class="p">);</span>
</pre></div>


<p><strong>错误消息模板</strong></p>
<p>From the examples above, you may have noticed that error messages support basic templating. There are a few other template keywords besides <code>{PATH}</code> and <code>{VALUE}</code> too. To find out more, details are available [here</p>
<p><strong>异步验证</strong></p>
<p>Passing a validator function that receives two arguments tells mongoose that the validator is an asynchronous validator. The first argument passed to the validator function is the value being validated. The second argument is a callback function that must called when you finish validating the value and passed either <code>true</code> or <code>false</code> to communicate either success or failure respectively.</p>
<div class="codehilite"><pre><span></span>schema.path(&#39;name&#39;).validate({
  isAsync: true,
  validator: function (value, respond) {
    doStuff(value, function () {
      ...
      respond(false);
    });
  },
  message: &#39;Custom error message!&#39;
});

schema.path(&#39;name&#39;).validate({
  validator: function (value) {
    return new Promise(function (resolve, reject) {
      resolve(false);
    });
  }
});
</pre></div>


<p>You might use asynchronous validators to retreive other documents from the database to validate against or to meet other I/O bound validation needs.</p>
<p>Validation occurs <code>pre('save')</code> or whenever you manually execute [document#validate.</p>
<p>If validation fails during <code>pre('save')</code> and no callback was passed to receive the error, an <code>error</code> event will be emitted on your Models associated db [connection, passing the validation error object along.</p>
<div class="codehilite"><pre><span></span>var conn = mongoose.createConnection(..);
conn.on(&#39;error&#39;, handleError);

var Product = conn.model(&#39;Product&#39;, yourSchema);
var dvd = new Product(..);
dvd.save();
</pre></div>


<p>If you desire handling these errors at the Model level, attach an <code>error</code> listener to your Model and the event will instead be emitted there.</p>
<div class="codehilite"><pre><span></span>Product.on(&#39;error&#39;, handleError);
</pre></div>


<h2 id="schematypeprototyperequired">SchemaType.prototype.required()<a class="headerlink" href="#schematypeprototyperequired" title="Permanent link">&para;</a></h2>
<p><strong>参数</strong></p>
<ul>
<li>[message] «String» optional custom error message</li>
</ul>
<p><strong>返回</strong></p>
<p>Adds a required validator to this SchemaType. The validator gets added to the front of this SchemaType's validators array using <code>unshift()</code>.</p>
<p><strong>示例</strong></p>
<div class="codehilite"><pre><span></span><span class="nt">var</span> <span class="nt">s</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">born</span><span class="p">:</span> <span class="err">{</span> <span class="n">type</span><span class="o">:</span> <span class="n">Date</span><span class="p">,</span> <span class="n">required</span><span class="o">:</span> <span class="n">true</span> <span class="p">}</span><span class="o">)</span>

<span class="nt">var</span> <span class="nt">s</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">born</span><span class="p">:</span> <span class="err">{</span> <span class="n">type</span><span class="o">:</span> <span class="n">Date</span><span class="p">,</span> <span class="n">required</span><span class="o">:</span> <span class="s1">&#39;{PATH} is required!&#39;</span> <span class="p">}</span><span class="o">)</span>

<span class="nt">var</span> <span class="nt">s</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span>
  <span class="n">userId</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">,</span>
  <span class="n">username</span><span class="o">:</span> <span class="err">{</span>
    <span class="n">type</span><span class="o">:</span> <span class="n">String</span><span class="p">,</span>
    <span class="n">required</span><span class="o">:</span> <span class="nf">function</span><span class="p">()</span> <span class="err">{</span> <span class="n">return</span> <span class="n">this</span><span class="o">.</span><span class="n">userId</span> <span class="o">!=</span> <span class="n">null</span><span class="p">;</span> <span class="p">}</span>
  <span class="err">}</span>
<span class="err">}</span><span class="o">)</span>

<span class="nt">var</span> <span class="nt">s</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span>
  <span class="n">userId</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">,</span>
  <span class="n">username</span><span class="o">:</span> <span class="err">{</span>
    <span class="n">type</span><span class="o">:</span> <span class="n">String</span><span class="p">,</span>
    <span class="n">required</span><span class="o">:</span> <span class="cp">[</span>
      <span class="nx">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">this.userId</span> <span class="o">!=</span> <span class="kt">null</span><span class="p">;</span> <span class="p">},</span>
      <span class="s1">&#39;username is required if id is specified&#39;</span>
    <span class="cp">]</span>
  <span class="p">}</span>
<span class="err">}</span><span class="o">)</span>

<span class="nt">Schema</span><span class="p">.</span><span class="nc">path</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">)</span><span class="p">.</span><span class="nc">required</span><span class="o">(</span><span class="nt">true</span><span class="o">);</span>

<span class="nt">Schema</span><span class="p">.</span><span class="nc">path</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">)</span><span class="p">.</span><span class="nc">required</span><span class="o">(</span><span class="nt">true</span><span class="o">,</span> <span class="s1">&#39;grrr :( &#39;</span><span class="o">);</span>

<span class="nt">var</span> <span class="nt">isOver18</span> <span class="o">=</span> <span class="nt">function</span><span class="o">()</span> <span class="p">{</span> <span class="err">return</span> <span class="err">this.age</span> <span class="err">&gt;=</span> <span class="err">18</span><span class="p">;</span> <span class="p">}</span><span class="o">;</span>
<span class="nt">Schema</span><span class="p">.</span><span class="nc">path</span><span class="o">(</span><span class="s1">&#39;voterRegistrationId&#39;</span><span class="o">)</span><span class="p">.</span><span class="nc">required</span><span class="o">(</span><span class="nt">isOver18</span><span class="o">);</span>
</pre></div>


<p>The required validator uses the SchemaType's <code>checkRequired</code> function to determine whether a given value satisfies the required validator. By default, a value satisfies the required validator if <code>val != null</code> (that is, if the value is not null nor undefined). However, most built-in mongoose schema types override the default <code>checkRequired</code> function:</p>
<h2 id="schematypeprototypeselect">SchemaType.prototype.select()<a class="headerlink" href="#schematypeprototypeselect" title="Permanent link">&para;</a></h2>
<p><strong>参数</strong></p>
<p><strong>返回</strong></p>
<p>Sets default <code>select()</code> behavior for this path.</p>
<p>Set to <code>true</code> if this path should always be included in the results, <code>false</code> if it should be excluded by default. This setting can be overridden at the query level.</p>
<p><strong>示例</strong></p>
<div class="codehilite"><pre><span></span><span class="nt">T</span> <span class="o">=</span> <span class="nt">db</span><span class="p">.</span><span class="nc">model</span><span class="o">(</span><span class="s1">&#39;T&#39;</span><span class="o">,</span> <span class="nt">new</span> <span class="nt">Schema</span><span class="o">(</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="err">{</span> <span class="n">type</span><span class="o">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">select</span><span class="o">:</span> <span class="n">true</span> <span class="p">}</span><span class="err">}</span><span class="o">));</span>
<span class="nt">T</span><span class="p">.</span><span class="nc">find</span><span class="o">(..);</span>

<span class="nt">T</span><span class="p">.</span><span class="nc">find</span><span class="o">()</span><span class="p">.</span><span class="nc">select</span><span class="o">(</span><span class="s1">&#39;-x&#39;</span><span class="o">)</span><span class="p">.</span><span class="nc">exec</span><span class="o">(</span><span class="nt">callback</span><span class="o">);</span>
</pre></div>


<hr />
<hr />
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../api/" title="模式API" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                模式API
              </span>
            </div>
          </a>
        
        
          <a href="../../model/guide/" title="模型手册" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                模型手册
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            版权 &copy; 2018 -  wohugb.github.io
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="http://wohugb.github.io" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/wohugb" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/wohugb" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/wohugb" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.6cdc17f0.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              <script src="../../assets/javascripts/lunr/lunr.zh.js"></script>
            
          
          
        
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>